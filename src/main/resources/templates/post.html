<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>게시판 홈</title>
  <style>
    /* Body 스타일 */
body {
    background-color: #222;
    color: #ddd;
    font-family: Arial, sans-serif;
}

/* 로그인 버튼 스타일 */
#login-button button {
    position: absolute;
    top: 20px;
    right: 20px;
    width : 95px;
    background-color: #333;
    color: #fff;
    border: none;
    padding: 10px 20px;
    margin-top: 10px;
    border-radius: 5px;
    cursor: pointer;
}

/* 로고 스타일 */

#logo {
    text-align: center;
    margin-top: 50px;
}

#logo h1 {
    text-decoration: none;
    color: #fff;
    font-size: 50px;
    font-family: 'Arial Black';
}

/* 카테고리 선택 버튼 스타일 */
#categories {
    text-align: center; /* 내용을 수평으로 가운데 정렬 */
    margin-top: 20px;
}

#categories button {
    background-color: #444;
    color: #fff;
    border: none;
    padding: 10px 20px;
    margin: 5px;
    border-radius: 5px;
    cursor: pointer;
    display: inline-block; /* 가로로 정렬하기 위해 인라인 블록 요소로 설정 */
}


#author-views p {
    color: #bbb; /* 더 어두운 회색 */
}

.container {
        max-width: 800px; /* 컨테이너 최대 너비 설정 */
        margin: 50px auto; /* 페이지 중앙 정렬 */
        padding: 20px; /* 내부 여백 */
        background-color: #333; /* 배경색 */
        border-radius: 5px; /* 테두리 반경 */
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* 그림자 효과 */
    }

    .content-top {
display: flex;
}

.content-top .child {
flex: 1;

}


#postTitle, #postContent {
    width: 100%; /* 입력 필드 폭 전체로 설정 */
        padding: 10px; /* 내부 여백 */
        margin-bottom: 20px; /* 입력 필드 아래 여백 */
        border: 1px solid #555; /* 테두리 */
        border-radius: 4px; /* 테두리 반경 */
        box-sizing: border-box; /* 박스 크기 및 테두리 상자 크기 설정 */
        background-color: #444; /* 배경색 */
        color: #ddd; /* 텍스트 색상 */
}

    .btn-group {
  display: flex;
  }

    button[type="submit"]
    {
        padding: 10px 20px; /* 버튼 내부 여백 */
        border: none; /* 테두리 없음 */
        border-radius: 4px; /* 버튼 반경 */
        cursor: pointer; /* 커서 포인터로 변경 */
    }

.btn-primary {
    background-color: #007bff; /* 제출 버튼 배경색 */
    color: #fff; /* 제출 버튼 글꼴 색상 */
    margin-right: 10px; /* 제출 버튼 오른쪽 여백 */
}

.btn-danger {
    background-color: #6c757d; /* 취소 버튼 배경색 */
    color: #fff; /* 취소 버튼 글꼴 색상 */
}

    .container2 {
    max-width: 800px; /* 컨테이너 최대 너비 설정 */
        margin: 50px auto; /* 페이지 중앙 정렬 */
        padding: 20px; /* 내부 여백 */
        background-color: #333; /* 배경색 */
        border-radius: 5px; /* 테두리 반경 */
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* 그림자 효과 */
    }

    .comment-btn {
    display: flex;
    }

    .comment-reg {
    display: flex;
    justify-content: space-between;
    }

    .form-control {
        width: 90%; /* 입력 필드 폭 전체로 설정 */
        padding: 10px; /* 내부 여백 */
        border: 1px solid #555; /* 테두리 */
        border-radius: 4px; /* 테두리 반경 */
        box-sizing: border-box; /* 박스 크기 및 테두리 상자 크기 설정 */
        background-color: #444; /* 배경색 */
        color: #ddd; /* 텍스트 색상 */
    }

    .comment-content{
      margin-top: 5px;
      margin-bottom: 3px;
    }

    .comment-line {
    border-top: 1px solid #444444;
    margin-bottom: 5px;
    }

button[type="submit2"]
    {
        border: none; /* 테두리 없음 */
        border-radius: 2px; /* 버튼 반경 */
        cursor: pointer; /* 커서 포인터로 변경 */
        margin-bottom: 10px;
    }
    .edit-btn {
    background-color: #007bff; /* 제출 버튼 배경색 */
    color: #fff; /* 제출 버튼 글꼴 색상 */
    margin-right: 3px; /* 제출 버튼 오른쪽 여백 */
}
    .del-btn {
    background-color: #6c757d; /* 취소 버튼 배경색 */
    color: #fff; /* 취소 버튼 글꼴 색상 */
}

  </style>
</head>
<body>

<!-- 로그인 버튼 -->
<div id="login-button">
  <form th:action="@{/logout}" method="post">
    <button class="w-100 btn btn-dark btn-lg" type="submint">
      로그아웃
    </button>
  </form>
</div>

<!-- 로고 -->
<a href="/">
  <div id="logo">
    <h1>MUSE</h1>
  </div>
</a>

<!-- 카테고리 선택 버튼 -->
<div id="categories" style="text-align: center;">
  <button>전체</button>
  <button>일렉기타</button>
  <button>베이스</button>
  <button>어쿠스틱</button>
  <button>키보드</button>
  <button>드럼</button>
  <button>앰프</button>
  <button>마이크</button>
</div>


<!-- 게시글 정보 -->
<div class="container">
  <!-- 작성자 및 조회수 -->
  <div class="content-top">
    <div class="child left">
      <p>닉네임 : <span th:text="${post.memberEntity.memberNickname}"></span></p>
    </div>
    <div class="child center">
      <p>카테고리 : <span th:text="${post.category}"></span></p></div>
    <div class="child right">
      <p>조회수 : <span th:text="${post.view}"></span></p>
    </div>
  </div>

  <div>
    <label for="postTitle">제목</label>
    <input type="text" id="postTitle" name="postTitle" class="form-control"
           value="제목" th:value="${post.title}" readonly>
  </div>

  <!-- 본문 -->
  <div>
    <label for="postContent">내용</label>
    <textarea class="form-control" rows="5"
              id="postContent" name="postContent"
              th:value="${post.content}" th:text="${post.content}" readonly></textarea>
  </div>

  <hr class="my-4">
  <div class="btn-group">
    <form th:action="@{${postId} + '/edit'}" method="get" class="btn-form">
      <button class="btn btn-primary" type="submit">수정</button>
    </form>
    <form th:action="@{${postId} + '/delete'}" method="post" class="btn-form">
      <button class="btn btn-danger" type="submit">삭제</button>
    </form>
  </div>

</div>

<div class="container2">
  <div th:if="${comments != null and comments.size() != 0}">
    <div th:each="comment : ${comments}">
      <p class="comment-content" th:text="${comment.getContent()}"></p>
      <div class="comment-line"></div>
      <div class="comment-btn">
        <!--        모달수정시작-->
        <button type="submit2" onclick="openCommentUpdatePopup(${comment.getId()});"
                class="btn edit-btn"><span
            class="icons icon_modify">수정</span></button>
        <!--        모달 수정끝-->
        <button type="submit2" class="btn del-btn"
                th:href="@{{id}/comment/{commentId}/remove(id=${id}, commentId=${comment.getId()})}"
                th:attr="data-id=${comment.getId()}" onclick="return confirm('삭제하시겠습니까?')">삭제
        </button>
      </div>
    </div>
  </div>

  <form th:action="@{'/' + ${id} + '/comment'}" method="post" class="comment-reg">
    <input type="hidden" name="idx" th:value="*{idx}"/>
    <textarea name="content" class="form-control"></textarea>
    <button type="submit" class="btn btn-primary">등록</button>
  </form>
</div>
<!--/* 댓글 수정 popup */-->
<!--<div id="commentUpdatePopup" class="popLayer">-->
<!--  <h3>댓글 수정</h3>-->
<!--  <div class="pop_container">-->
<!--    <table class="tb tb_row tl">-->
<!--      <colgroup>-->
<!--        <col style="width:30%;"/>-->
<!--        <col style="width:70%;"/>-->
<!--      </colgroup>-->
<!--      <tbody>-->
<!--      <tr>-->
<!--        <th scope="row">내용<span class="es">필수 입력</span></th>-->
<!--        <td><textarea id="modalContent" name="modalContent" cols="90" rows="10"-->
<!--                      placeholder="수정할 내용을 입력해 주세요."></textarea></td>-->
<!--      </tr>-->
<!--      </tbody>-->
<!--    </table>-->
<!--    <p class="btn_set">-->
<!--      <button type="button" id="commentUpdateBtn" class="btns btn_st2">수정</button>-->
<!--      <button type="button" class="btns btn_bdr2" onclick="closeCommentUpdatePopup();">취소</button>-->
<!--    </p>-->
<!--  </div>-->
<!--  <button type="button" class="btn_close" onclick="closeCommentUpdatePopup();"><span><i-->
<!--      class="far fa-times-circle"></i></span></button>-->
<!--</div>-->
<!-- 모달 이벤트 처리 -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
  // 댓글 수정 팝업 open
function openCommentUpdatePopup(id) {

    const postId = [[ ${post.id} ]];

    $.ajax({
        url : `/${postId}/comment/${id}/update`,
        type : 'get',
        dataType : 'json',
        async : false,
        success : function (response) {
            document.getElementById('modalContent').value = response.content;
            document.getElementById('commentUpdateBtn').setAttribute('onclick', `updateComment(${id})`);
            layerPop('commentUpdatePopup');
        },
        error : function (request, status, error) {
            console.log(error)
        }
    })
}


// 댓글 수정 팝업 close
function closeCommentUpdatePopup() {
    document.querySelectorAll('#modalContent').forEach(element => element.value = '');
    document.getElementById('commentUpdateBtn').removeAttribute('onclick');
    layerPopClose('commentUpdatePopup');
}
    // 댓글 수정
    function updateComment(id) {

        const content = document.getElementById('modalContent');
        isValid(content, '수정할 내용');

        const postId = [[ ${post.id} ]];
        const params = {
            id : id,
            postId : postId,
            content : content.value
        }

        $.ajax({
            url : `/${postId}/comment/${id}/update`,
            type : 'patch',
            contentType : 'application/json; charset=utf-8',
            dataType : 'json',
            data : JSON.stringify(params),
            async : false,
            success : function (response) {
                alert('수정되었습니다.');
                closeCommentUpdatePopup();
                findAllComment();
            },
            error : function (request, status, error) {
                console.log(error)
            }
        })
    }
</script>

</body>
</html>
